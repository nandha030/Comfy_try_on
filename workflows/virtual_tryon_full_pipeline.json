{
  "last_node_id": 42,
  "last_link_id": 85,
  "nodes": [

    {
      "id": 1,
      "type": "LoadImage",
      "title": "Load Person Image",
      "pos": [40, 100],
      "size": [210, 230],
      "outputs": [
        {"name": "IMAGE", "type": "IMAGE", "links": [1, 2, 3, 4]},
        {"name": "MASK",  "type": "MASK",  "links": []}
      ],
      "widgets_values": ["girl.jpg", "image"]
    },

    {
      "id": 2,
      "type": "LoadImage",
      "title": "Load Garment Image",
      "pos": [40, 420],
      "size": [210, 230],
      "outputs": [
        {"name": "IMAGE", "type": "IMAGE", "links": [5, 6]},
        {"name": "MASK",  "type": "MASK",  "links": []}
      ],
      "widgets_values": ["garment.jpg", "image"]
    },

    {
      "id": 3,
      "type": "DWPreprocessor",
      "title": "DWPose — Skeleton Keypoints",
      "pos": [300, 40],
      "size": [260, 160],
      "inputs":  [{"name": "image", "type": "IMAGE", "link": 1}],
      "outputs": [{"name": "IMAGE", "type": "IMAGE", "links": [7]}],
      "widgets_values": [512, 768, "enable", "enable", "enable"]
    },

    {
      "id": 4,
      "type": "DepthAnythingV2Preprocessor",
      "title": "Depth Anything V2 — Body Depth",
      "pos": [300, 240],
      "size": [260, 130],
      "inputs":  [{"name": "image", "type": "IMAGE", "link": 2}],
      "outputs": [{"name": "IMAGE", "type": "IMAGE", "links": [8]}],
      "widgets_values": [518, "vitl"]
    },

    {
      "id": 5,
      "type": "LayerMask: Human Parts Ultra",
      "title": "LayerMask — Garment Region Mask",
      "pos": [300, 420],
      "size": [310, 520],
      "inputs":  [{"name": "image", "type": "IMAGE", "link": 3}],
      "outputs": [
        {"name": "image", "type": "IMAGE", "links": [9]},
        {"name": "mask",  "type": "MASK",  "links": [10]}
      ],
      "widgets_values": [
        "disabled", "disabled", "disabled",
        "enabled",
        "disabled",
        "disabled", "disabled", "disabled",
        "disabled", "disabled", "disabled", "disabled",
        "VITMatte", 8, 6, 0.01, 0.99, true, "cpu", 2.0
      ],
      "note": "top_clothes=enabled (slot 4 of 12). Switch to bottom_clothes for pants. Use CR Switch to auto-route."
    },

    {
      "id": 6,
      "type": "LayerMask: Human Parts Ultra",
      "title": "LayerMask — Face + Skin Preservation Mask",
      "pos": [300, 1000],
      "size": [310, 520],
      "inputs":  [{"name": "image", "type": "IMAGE", "link": 4}],
      "outputs": [
        {"name": "image", "type": "IMAGE", "links": [11]},
        {"name": "mask",  "type": "MASK",  "links": [12]}
      ],
      "widgets_values": [
        "enabled",
        "enabled",
        "disabled",
        "disabled",
        "disabled",
        "enabled",
        "enabled", "enabled",
        "disabled", "disabled", "disabled", "disabled",
        "VITMatte", 8, 6, 0.01, 0.99, true, "cpu", 2.0
      ],
      "note": "face=enabled, hair=enabled, torso_skin=enabled, left_arm=enabled, right_arm=enabled — preserves all exposed skin"
    },

    {
      "id": 7,
      "type": "WD14Tagger|pysssss",
      "title": "WD14 Auto Garment Classifier",
      "pos": [300, 660],
      "size": [260, 160],
      "inputs":  [{"name": "image", "type": "IMAGE", "link": 6}],
      "outputs": [{"name": "tags", "type": "STRING", "links": [13]}],
      "widgets_values": ["wd-v1-4-convnext-tagger-v2", 0.35, false, true],
      "note": "Outputs garment type tags: t-shirt, pants, dress, saree, kurta etc. Feed into CR Switch to auto-select mask."
    },

    {
      "id": 8,
      "type": "CR Switch",
      "title": "Garment Type Router (Top / Bottom / Full)",
      "pos": [620, 540],
      "size": [240, 160],
      "inputs": [
        {"name": "Input",   "type": "*",    "link": 13},
        {"name": "switch1", "type": "INT",  "link": null}
      ],
      "outputs": [
        {"name": "top",    "type": "MASK", "links": [14]},
        {"name": "bottom", "type": "MASK", "links": [15]},
        {"name": "full",   "type": "MASK", "links": [16]}
      ],
      "widgets_values": [1],
      "note": "1=top, 2=bottom, 3=full-body. Auto-set by WD14 tags or override manually."
    },

    {
      "id": 9,
      "type": "BiRefNet",
      "title": "BiRefNet — Garment Background Removal",
      "pos": [620, 420],
      "size": [240, 130],
      "inputs":  [{"name": "image", "type": "IMAGE", "link": 5}],
      "outputs": [
        {"name": "image", "type": "IMAGE", "links": [17]},
        {"name": "mask",  "type": "MASK",  "links": [18]}
      ],
      "widgets_values": ["BiRefNet-general", 1024]
    },

    {
      "id": 10,
      "type": "CatVTON Wrapper",
      "title": "CatVTON — Garment Try-On",
      "pos": [920, 300],
      "size": [300, 280],
      "inputs": [
        {"name": "image",        "type": "IMAGE", "link": 9},
        {"name": "mask",         "type": "MASK",  "link": 14},
        {"name": "refer_image",  "type": "IMAGE", "link": 17},
        {"name": "pose_image",   "type": "IMAGE", "link": 7},
        {"name": "depth_image",  "type": "IMAGE", "link": 8}
      ],
      "outputs": [{"name": "image", "type": "IMAGE", "links": [19]}],
      "widgets_values": [25, "fp16", 9390658395131, "randomize", 50, 3.0],
      "note": "mask_grow=25, steps=50, cfg=3.0. Pose + Depth inputs improve shoulder alignment and fabric drape accuracy."
    },

    {
      "id": 11,
      "type": "ControlNetLoader",
      "title": "Load ControlNet Tile Model",
      "pos": [920, 620],
      "size": [260, 80],
      "outputs": [{"name": "CONTROL_NET", "type": "CONTROL_NET", "links": [20]}],
      "widgets_values": ["control_v11f1e_sd15_tile.pth"]
    },

    {
      "id": 12,
      "type": "TilePreprocessor",
      "title": "Tile Preprocessor — Texture Sharpening",
      "pos": [920, 720],
      "size": [240, 100],
      "inputs":  [{"name": "image", "type": "IMAGE", "link": 19}],
      "outputs": [{"name": "IMAGE", "type": "IMAGE", "links": [21]}],
      "widgets_values": [3]
    },

    {
      "id": 13,
      "type": "ControlNetApplyAdvanced",
      "title": "ControlNet Tile — Apply Texture Refinement",
      "pos": [1240, 580],
      "size": [280, 200],
      "inputs": [
        {"name": "positive",    "type": "CONDITIONING", "link": 22},
        {"name": "negative",    "type": "CONDITIONING", "link": 23},
        {"name": "control_net", "type": "CONTROL_NET",  "link": 20},
        {"name": "image",       "type": "IMAGE",        "link": 21}
      ],
      "outputs": [
        {"name": "positive", "type": "CONDITIONING", "links": [24]},
        {"name": "negative", "type": "CONDITIONING", "links": [25]}
      ],
      "widgets_values": [0.6, 0.0, 1.0]
    },

    {
      "id": 14,
      "type": "CLIPTextEncode",
      "title": "Positive Prompt",
      "pos": [920, 860],
      "size": [280, 100],
      "inputs":  [{"name": "clip", "type": "CLIP", "link": 26}],
      "outputs": [{"name": "CONDITIONING", "type": "CONDITIONING", "links": [22]}],
      "widgets_values": ["high quality photo, realistic fabric texture, accurate clothing fit, sharp garment details, natural skin tone, professional fashion photography"]
    },

    {
      "id": 15,
      "type": "CLIPTextEncode",
      "title": "Negative Prompt",
      "pos": [920, 980],
      "size": [280, 100],
      "inputs":  [{"name": "clip", "type": "CLIP", "link": 27}],
      "outputs": [{"name": "CONDITIONING", "type": "CONDITIONING", "links": [23]}],
      "widgets_values": ["blurry, deformed, distorted fabric, wrong skin color, artifacts, low quality, disfigured face, extra limbs, bad anatomy"]
    },

    {
      "id": 16,
      "type": "ImageColorMatch",
      "title": "Skin Tone Color Match",
      "pos": [1240, 300],
      "size": [260, 140],
      "inputs": [
        {"name": "image_ref",    "type": "IMAGE", "link": 11},
        {"name": "image_target", "type": "IMAGE", "link": 19}
      ],
      "outputs": [{"name": "image", "type": "IMAGE", "links": [28]}],
      "widgets_values": ["LAB", 0.7],
      "note": "Uses LAB color space. Matches skin tone of try-on output to original person. Strength=0.7 — adjust per skin tone."
    },

    {
      "id": 17,
      "type": "ImageCompositeMasked",
      "title": "Composite — Paste Original Face + Hair Back",
      "pos": [1560, 300],
      "size": [260, 160],
      "inputs": [
        {"name": "destination", "type": "IMAGE", "link": 28},
        {"name": "source",      "type": "IMAGE", "link": 11},
        {"name": "mask",        "type": "MASK",  "link": 12}
      ],
      "outputs": [{"name": "IMAGE", "type": "IMAGE", "links": [29]}],
      "widgets_values": [0, 0, true],
      "note": "Hard-pastes original face + hair from person photo back onto try-on result using preserved skin mask."
    },

    {
      "id": 18,
      "type": "MaskFeatherRegion",
      "title": "Feather Mask Edges (Skin-Garment Blend)",
      "pos": [1560, 500],
      "size": [240, 100],
      "inputs":  [{"name": "mask", "type": "MASK", "link": 12}],
      "outputs": [{"name": "MASK", "type": "MASK", "links": [30]}],
      "widgets_values": [10],
      "note": "Softens boundary by 10px between garment and skin. Eliminates hard-edge artifacts."
    },

    {
      "id": 19,
      "type": "ImageCompositeMasked",
      "title": "Composite — Soft Blend Skin Regions",
      "pos": [1560, 640],
      "size": [260, 160],
      "inputs": [
        {"name": "destination", "type": "IMAGE", "link": 29},
        {"name": "source",      "type": "IMAGE", "link": 28},
        {"name": "mask",        "type": "MASK",  "link": 30}
      ],
      "outputs": [{"name": "IMAGE", "type": "IMAGE", "links": [31]}],
      "widgets_values": [0, 0, true]
    },

    {
      "id": 20,
      "type": "ICLight",
      "title": "IC-Light — Lighting Harmonization",
      "pos": [1880, 400],
      "size": [260, 160],
      "inputs": [
        {"name": "image",     "type": "IMAGE", "link": 31},
        {"name": "ref_image", "type": "IMAGE", "link": 11}
      ],
      "outputs": [{"name": "image", "type": "IMAGE", "links": [32]}],
      "widgets_values": ["iclight_sd15_fc.safetensors", 1.0, 20, 1.5],
      "note": "Re-lights garment to match face/background lighting. Makes compositing look photorealistic."
    },

    {
      "id": 21,
      "type": "CodeFormer",
      "title": "CodeFormer — Face Restoration",
      "pos": [1880, 600],
      "size": [260, 140],
      "inputs":  [{"name": "image", "type": "IMAGE", "link": 32}],
      "outputs": [{"name": "IMAGE", "type": "IMAGE", "links": [33]}],
      "widgets_values": [0.4, true, true],
      "note": "Fidelity=0.4 — low enough to enhance without replacing face identity. Do NOT go above 0.6."
    },

    {
      "id": 22,
      "type": "MaskPreview",
      "title": "Mask Preview — Garment Region",
      "pos": [620, 700],
      "size": [200, 200],
      "inputs": [{"name": "mask", "type": "MASK", "link": 10}]
    },

    {
      "id": 23,
      "type": "MaskPreview",
      "title": "Mask Preview — Skin/Face Region",
      "pos": [620, 940],
      "size": [200, 200],
      "inputs": [{"name": "mask", "type": "MASK", "link": 12}]
    },

    {
      "id": 24,
      "type": "PreviewImage",
      "title": "Preview — CatVTON Raw Output",
      "pos": [1240, 100],
      "size": [300, 300],
      "inputs": [{"name": "images", "type": "IMAGE", "link": 19}]
    },

    {
      "id": 25,
      "type": "PreviewImage",
      "title": "FINAL OUTPUT — Full Pipeline Result",
      "pos": [2180, 400],
      "size": [380, 500],
      "inputs": [{"name": "images", "type": "IMAGE", "link": 33}]
    },

    {
      "id": 26,
      "type": "SaveImage",
      "title": "Save Final Result",
      "pos": [2180, 940],
      "size": [300, 130],
      "inputs": [{"name": "images", "type": "IMAGE", "link": 33}],
      "widgets_values": ["tryon_result", "png", true]
    }

  ],

  "links": [
    [1,  1, 0,  3, 0, "IMAGE"],
    [2,  1, 0,  4, 0, "IMAGE"],
    [3,  1, 0,  5, 0, "IMAGE"],
    [4,  1, 0,  6, 0, "IMAGE"],
    [5,  2, 0,  9, 0, "IMAGE"],
    [6,  2, 0,  7, 0, "IMAGE"],
    [7,  3, 0, 10, 3, "IMAGE"],
    [8,  4, 0, 10, 4, "IMAGE"],
    [9,  5, 0, 10, 0, "IMAGE"],
    [10, 5, 1, 22, 0, "MASK"],
    [11, 6, 0, 16, 0, "IMAGE"],
    [12, 6, 1, 17, 2, "MASK"],
    [13, 7, 0,  8, 0, "STRING"],
    [14, 8, 0, 10, 1, "MASK"],
    [17, 9, 0, 10, 2, "IMAGE"],
    [19,10, 0, 24, 0, "IMAGE"],
    [19,10, 0, 12, 0, "IMAGE"],
    [19,10, 0, 16, 1, "IMAGE"],
    [20,11, 0, 13, 2, "CONTROL_NET"],
    [21,12, 0, 13, 3, "IMAGE"],
    [22,14, 0, 13, 0, "CONDITIONING"],
    [23,15, 0, 13, 1, "CONDITIONING"],
    [28,16, 0, 17, 0, "IMAGE"],
    [28,16, 0, 19, 1, "IMAGE"],
    [29,17, 0, 19, 0, "IMAGE"],
    [30,18, 0, 19, 2, "MASK"],
    [31,19, 0, 20, 0, "IMAGE"],
    [11, 6, 0, 20, 1, "IMAGE"],
    [12, 6, 1, 23, 0, "MASK"],
    [32,20, 0, 21, 0, "IMAGE"],
    [33,21, 0, 25, 0, "IMAGE"],
    [33,21, 0, 26, 0, "IMAGE"]
  ],

  "groups": [
    {
      "title": "INPUT",
      "bounding": [20, 60, 270, 620],
      "color": "#1a3a2a"
    },
    {
      "title": "POSE + DEPTH CONDITIONING",
      "bounding": [280, 20, 280, 360],
      "color": "#1a2a3a"
    },
    {
      "title": "MASKING LAYER",
      "bounding": [280, 380, 580, 800],
      "color": "#2a1a3a"
    },
    {
      "title": "GARMENT PROCESSING",
      "bounding": [280, 640, 580, 260],
      "color": "#3a2a1a"
    },
    {
      "title": "CATVTON CORE",
      "bounding": [900, 260, 320, 320],
      "color": "#3a1a1a"
    },
    {
      "title": "SKIN TONE + FACE PRESERVATION",
      "bounding": [1220, 260, 620, 560],
      "color": "#1a3a1a"
    },
    {
      "title": "LIGHTING + FACE RESTORE",
      "bounding": [1860, 360, 280, 420],
      "color": "#2a2a1a"
    },
    {
      "title": "OUTPUT",
      "bounding": [2160, 360, 420, 740],
      "color": "#1a1a3a"
    }
  ],

  "_meta": {
    "created_by": "Virtual Try-On Full Pipeline",
    "version": "2.0",
    "description": "Full CatVTON pipeline with DWPose skeleton, Depth Anything V2, WD14 auto garment classification, BiRefNet garment BG removal, Face+Skin preservation, LAB color skin tone matching, IC-Light harmonization, CodeFormer face restoration.",
    "required_custom_nodes": [
      "ComfyUI-LayerStyle (LayerMask Human Parts Ultra)",
      "comfyui-catVTON-wrapper",
      "comfyui-controlnet-aux (DWPose, Depth Anything V2, Tile Preprocessor)",
      "ComfyUI-WD14-Tagger",
      "ComfyUI-BiRefNet",
      "ComfyUI-IC-Light",
      "ComfyUI-CodeFormer",
      "ComfyUI-CR-Animation (CR Switch)",
      "ComfyUI_IPAdapter_plus"
    ],
    "required_models": [
      "control_v11f1e_sd15_tile.pth — ControlNet Tile",
      "iclight_sd15_fc.safetensors — IC-Light",
      "codeformer.pth — CodeFormer",
      "depth_anything_v2_vitl.pth — Depth Anything V2",
      "wd-v1-4-convnext-tagger-v2 — WD14 Tagger"
    ],
    "garment_switch_instructions": {
      "top_clothes": "Node 5: set top_clothes=enabled, bottom_clothes=disabled",
      "bottom_clothes": "Node 5: set top_clothes=disabled, bottom_clothes=enabled",
      "full_dress": "Node 5: set top_clothes=enabled, bottom_clothes=enabled, torso_skin=enabled",
      "saree_kurta": "Node 5: enable top+bottom+torso_skin. Increase mask_grow to 35 in CatVTON."
    },
    "skin_tone_tuning": {
      "fair_skin": "ImageColorMatch strength: 0.5",
      "medium_skin": "ImageColorMatch strength: 0.7",
      "deep_skin_indian": "ImageColorMatch strength: 0.8, sample from inner wrist region",
      "note": "LAB color space handles deep/warm Indian skin tones significantly better than RGB"
    },
    "codeformer_warning": "Keep fidelity at 0.3-0.5 maximum. Higher values change face identity."
  }
}
